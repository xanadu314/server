<!DOCTYPE html>
<html lang="zh-CN" dir="ltr" class="client-nojs">

<!-- Mirrored from hpc.ncpgr.cn:8093/mediawiki/index.php?title=PBS%E4%BD%BF%E7%94%A8&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 13 May 2019 09:34:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>查看“PBS使用”的源代码 - 作物遗传改良国家重点实验室集群系统</title>
<meta name="generator" content="MediaWiki 1.24.1" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="http://hpc.ncpgr.cn:8093/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://hpc.ncpgr.cn:8093/mediawiki/opensearch_desc.php" title="作物遗传改良国家重点实验室集群系统 (zh-cn)" />
<link rel="EditURI" type="application/rsd+xml" href="http://hpc.ncpgr.cn:8093/mediawiki/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/PBS使用" />
<link rel="alternate" type="application/atom+xml" title="作物遗传改良国家重点实验室集群系统的Atom feed" href="http://hpc.ncpgr.cn:8093/mediawiki/index.php?title=%E7%89%B9%E6%AE%8A:%E6%9C%80%E8%BF%91%E6%9B%B4%E6%94%B9&amp;feed=atom" />
<link rel="stylesheet" href="http://hpc.ncpgr.cn:8093/mediawiki/load.php?debug=false&amp;lang=zh-cn&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.vector.styles&amp;only=styles&amp;skin=vector&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="http://hpc.ncpgr.cn:8093/mediawiki/load.php?debug=false&amp;lang=zh-cn&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: wiki-wiki:resourceloader:filter:minify-css:7:fa3f35a35ca6833c3a136d86b661109f */</style>
<script src="http://hpc.ncpgr.cn:8093/mediawiki/load.php?debug=false&amp;lang=zh-cn&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"PBS使用","wgTitle":"PBS使用","wgCurRevisionId":175,"wgRevisionId":0,"wgArticleId":22,"wgIsArticle":false,"wgIsRedirect":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"zh-cn","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"zh","wgMonthNames":["","1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],"wgMonthNamesShort":["","1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],"wgRelevantPageName":"PBS使用","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"previewDialog":false,"publish":true}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"editfont":"default","editondblclick":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":1,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nickname":"","norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rows":25,"showhiddencats":0,"shownumberswatching":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":5,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":1,"watchdefault":1,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"watchrollback":0,
"wllimit":250,"useeditwarning":1,"prefershttps":1,"usebetatoolbar":1,"usebetatoolbar-cgd":1,"wikieditor-preview":1,"wikieditor-publish":1,"language":"zh-cn","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"variant":"zh-cn"});},{},{});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});},{},{});
/* cache key: wiki-wiki:resourceloader:filter:minify-js:7:01a64f4f54c00905cdabe1083f478124 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/mediawiki/skins/Vector/csshover.min.htc")}</style><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-PBS使用 skin-vector action-edit vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<h1 id="firstHeading" class="firstHeading" lang="zh-CN"><span dir="auto">查看“PBS使用”的源代码</span></h1>
						<div id="bodyContent" class="mw-body-content">
								<div id="contentSub">←<a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/PBS使用" title="PBS使用">PBS使用</a></div>
												<div id="jump-to-nav" class="mw-jump">
					跳转至：					<a href="#mw-navigation">导航</a>、					<a href="#p-search">搜索</a>
				</div>
				<div id="mw-content-text"><p>因为以下原因，你没有权限编辑本页：
</p>
<div class="permissions-errors">
<p>您请求的操作仅限属于该用户组的用户执行：<a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php?title=Cluster:%E7%94%A8%E6%88%B7&amp;action=edit&amp;redlink=1" class="new" title="Cluster:用户（页面不存在）">用户</a>
</p>
</div>
<hr />
<p>您可以查看并复制此页面的源代码：
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="zh-cn" dir="ltr" name="wpTextbox1" class="mw-ui-input">==PBS常用命令==
&lt;pre>
pbsnodes -o cu01 使cu01节点离线，不参与PBS作业分配
pbsnodes -c cu01 使cu01上线，参与到PBS的作业分配中

qstat -r 展示比较详细的作业状态
qstat -Q 所有作业的排队状态
qstat -u username 某个用户的作业
qstat -n 列出作业使用的节点和cpu核心
qstat -f 查看作业的详细信息
checkjobs jobid 可查看作业信息，包括申请、分配的计算资源
qdel -p 强制删除作业
qhold jobid 挂起作业
qrls jobid 取消挂起
tracejob jobid 追踪作业具体信息
printjob file.pbs  显示指定作业脚本中的作业信息

canceljob：取消已存在的作业
checkjob：显示作业状态、资源需求、环境、限制、信任、历史、已分配资源和资源利用等
nqs2pbs：将 nqs 作业脚本转换为 pbs 作业脚本
pbsnodes：显示节点信息
printjob：显示指定作业脚本中的作业信息
qdel：取消指定的作业
qhold：挂起一个作业
qmove：将一个作业从一个队列移到另一个队列中
qnodes：pbsnodes 的别名，显示节点信息
qorder：交换两个作业的排队顺序
qrls：将被挂起的作业送入准备运行的队列中
qselect：显示符合条件的作业的作业号
qstat：显示队列、服务节点和作业的信息
qsub：提交作业
showbf：显示有特殊资源需求的资源的可用性
showq：显示已激活和空闲的作业的优先级细节
showstart：显示空闲作业的估计开始时间
tracejob：追踪作业信息
若不希望某节点能提交作业，可以用pbsnodes –o “节点名”，使其无法提交作业。
&lt;/pre>
[[分类:服务器]]

==后台提交作业qsub==

===语法===
qsub [-a date_time] 
[-A account_string] 
[-e path] 
[-h] 
[-I] 
[-j join] 
[-k keep] 
[-l resource_list] 
[-m mail_options] 
[-n Node_allocation_Method 
[-L v1,[v2,[v3,[v4]]]]] 
[-M user_list] 
[-N name] 
[-o path] 
[-p priority] 
[-q pool] 
[-r y|n] 
[-u user_list] 
[-v variable_list] 
[-V] [script]

===参数===
script参数被省略时，该命令可以从标准输入获得脚本文件名。

* -a 时间。格式为[[[[CC]YY]MM]DD]hhmm[.SS]。CC表示世纪，YY表示年（后两位数字），MM表示月（两位数字），DD表示天（两位数 字），hh表示小时（两位数字），mm表示分（两位数字），SS表示秒（两位数字）。如果DD指定的是未来日子，而未指定MM，则MM缺省值为当前月，否 则，MM的缺省值为下个月。如果hhmm指定的未来时间，而未指定DD,则DD的缺省值为当天，否则，DD的缺省值为明天。如果提交作业时使用该选项，当 指定时间还没到时，作业状态显示为”W”。

*-e 指定错误输出文件名，格式为[hostname:]path_home。Hostname是返回错误输出文件的主机名，path_home是错误输出文件 的绝对路径，如果指定了相对路径，则相对用户的主目录。不使用该选项时，缺省值是在用户主目录下，以“作业名.e作业ID”命名的文件

*-o 指定输出文件名，格式为[hostname:]path_home。缺省值是在用户主目录下，以“作业名.e作业ID”命名的文件

*-h 指定在提交作业时，设置用户级’u’挂起。如果不指定，则设置挂起类型为’n’,即不挂起。

*-I 指定作业以交互方式运行。

*-j 指定合并错误输出和实际输出。如果指定’oe’，则合并到标准输出文件中；如果指定’eo’，则合并到标准错误输出文件中.

*-k 指定执行主机是否保留错误输出和实际输出。如果指定‘o’,则仅保留标准输出；如果指定’e’，则仅保留标准错误输出；如果指定’oe’或‘eo’,则保留标准输出和标准错误输出；如果指定’n’,则不保留任何输出。

*-l 指定作业所需要的资源，设定对可消耗资源的限制。如果不设置，则无限制。例如： resource_name[=[value]][,resource_name[=[value]],…]
LINUX系统可以设置的资源有cput, file, pcput, pmem, pvmem, vmem, walltime, arch, nodes, ncpus等；
&lt;pre>  
Cput指作业的所有进程使用cpu最长时间；

File指作业可以建立单个文件大小的最大限制；

Pcput指作业的单个进程可以使用CPU的最长时间；

vmem指作业可以使用的物理内存的最大值；

Pmem指作业的单个进程可以使用的物理内存的最大值；

Pvmem指作业的单个进程可以使用的虚拟内存的最大值；

walltime指作业处于运行状态的最长时间；

arch 指定系统管理员所定义的系统结构类型；

host指定作业运行的主机名；

nodes指定作业独占使用的结点数目和属性，使用“+”可以连接多种结点的定义。      
&lt;/pre>
结点的属性和主机名或数目之间通过“：”分隔。如果不指定结点数，则缺省为1。结点的属性包括ppn（每个结点上的进程数,缺省为1）和系统管理员设置的属性（如batch、bigmem）
例如：请求12个结点，不管其属性

         -l nodes=12

请求12个属性为batch的结点和14个属性为bigmem的结点

         -l nodes=12:batch+14:bigmem

请求4个结点，每个结点上使用2个CPU

         -l nodes=4:ppn=2

software 指作业要求的软件包

*-m 定义何时给用户发送有关作业的邮件。可设定的选项有：
&lt;pre>

n 不发送邮件

a 当作业被批处理系统中断时，发送邮件

b 当作业开始执行时，发送邮件

e 当作业执行结束时，发送邮件

&lt;/pre>
*-M 指定发送有关作业信息的邮件用户列表。格式为user[@host][,user@[host],…]缺省值为提交作业的用户。
*-N 指定作业的名字。缺省值为脚本的名字，如果没有指定脚本，则为STDIN。

*-p 指定作业的优先级，优先级的范围是[-1024, +1023]。缺省值是没有优先级。

*-q 指定作业的目的地(结点池)，目的地可有三种格式：
&lt;pre>
pool

@server

pool@server
&lt;/pre>
*-r y|n 指定作业是否可重新运行。指定‘y’时，作业可以重新运行；指定’n’时，作业不能重新运行。缺省值为’n’。

*      -z ： 指明qsub 命令提交作业后，不在终端显示作业号。

*      -v 格式为variable1,variable2,…或variable1=value,variable2=value,…这些变量和其值可以传递到作业中。

*      -V 指定qsub命令的所有的环境变量都传递到批处理作业中。

===作用===
以脚本文件的形式向批处理服务器提交作业。

===举例===
        

*把脚本文件cpi.ljrs提交到结点池dque中运行。
&lt;pre>

         $ qsub cpi.ljrs

         35.console

         $ qstat

         Job id Name User TimeUse S Pool

         35.console cpi zhangxq 0:00:00 R dque
&lt;/pre>
*把脚本作业cpi.ljrs提交到结点池long中运行，并且当作业开始运行时，给用户发送电子邮件。
&lt;pre>
         $qsub -P long -m b cpi.ljrs $qstat

         Job id Name User TimeUse S Pool

         36.console cpi zhangxq 0 R long
&lt;/pre>
*使用15个结点运行cpi.ljrs，运行时间不能大于2小时，作业占用的内存能大于15mb
&lt;pre>

         $qsub –l nodes=15,walltime=2:00:00,mem=15mb cpi.ljrs
&lt;/pre>
*综合考虑CPU、内存、缓冲区、硬盘等因素的使用情况，设置其权值分别为5, 4, 3, 2.
&lt;pre>
         $qsub –l nodes=5 -n syn –L 5, 4, 3, 2 cpi.ljrs
&lt;/pre>
*使用-I和–l选项在指定的结点上交互式运行作业
&lt;pre>
         $ qsub –I -l nodes=c0101
&lt;/pre>
运行该命令后,系统将自动切换到c0101的虚拟终端,所有的标准输入和标准输出和标准错误输出均都显示在该终端上. 在系统出现”waiting to jobid to start”时,用户若按^C键,即可中断该交互作业.当该交互作业已经启动后,用户除了交互式运行作业外,还可进行以下操作:
&lt;pre>
~. 该命令将使qsub退出，且终止作业。

~^Z挂起qsub,作业依然保持运行状态，无任何输入输出。用户可以在本地shell上提交命令。

~^Y部分挂起qsub，因为还可以给作业发送输入，而且接受作业的输出的同时，还可以在本地shell提交命令。
&lt;/pre>

==查看状态qstat==
===语法===
&lt;pre>
         qstat [-f][-W site_specific] [job_identifier... | destination...]

         qstat -Q [-f][-W site_specific] [destination...]

         qstat -B [-f] [-W site_specific] [server_name...]
&lt;/pre>
===参数===
*-q 显示已经配置的所有结点池状态信息
*-a 显示已经提交的作业状态信息
*-f 显示指定作业的所有状态信息
*-B 显示服务器的状态
*-n 显示作业分配的节点
destination可以为pool，@server，pool@server

===作用===
查看作业、结点池和批处理服务器的状态。命令格式一可以输出所指定作业ID或者结点池中所有作业的状态，命令格式二可以输出每个结点池的状态信息，命令格式三可以输出服务器的状态。

===举例===

* 显示已经配置的所有结点池状态信息。

         qstat -q

*显示已经提交的作业状态信息

         qstat -a

*显示指定作业的所有状态信息
&lt;pre>
         $ qstat -f 23.console

         mtime = Sun Apr 28 19:54:48 2002

         Output_Path = console:/home/zhangxq/cpi.o23

         Priority = 0

         qtime = Sun Apr 28 19:54:48 2002

         Rerunable = True

         Resource_List.cput = 00:00:59

         Resource_List.nodect = 2

         Resource_List.nodes = 2:ppn=1

         Variable_List = LJRS_O_HOME=/home/zhangxq,LJRS_O_LANG=en_US

         ……
&lt;/pre>
*显示服务器的状态
&lt;pre>
         $qstat –B

         Server Max Tot Que Run Hld Wat Trn Ext Status

         console 0 0 0 0 0 0 0 0 Active
&lt;/pre>

==查询作业qselect==

===语法===
qselect [-a [op]date_time] [-A account_string] [-h old_list] [-l resource_list] [-N name] [-p [op]priority] [-q destination] [-r y|n] [-s states] [-u user_list]

===参数===
op 表示某一个作业属性值和选项参数值之间的关系。如
&lt;pre>
         .eq. （等于）

         .ne. （不等于）

         .ge. （大于或等于）

         .gt. （大于）

         .le. （小于）
&lt;/pre>
其它参数含义见qsub命令。

===作用===
列出符合选项要求的作业ID。这些作业来自于单个服务器。如果没有任何选项，该命令则列出该用户被授权的服务器上的所有作业。对那些普通用户来说，该命令只显示该用户所提交的作业。

===举例===

*查询用户所提交的作业
&lt;pre>
         $ qsub -q long cpi.ljrs

         28.console

         $ qselect

         25.console

         28.console
&lt;/pre>
*查询指定结点池中的作业
&lt;pre>
         $ qstat

         Job id Name User TimeUse S Pool

         25.console cpi zhangxq 0 Q dque

         29.console cpi zhangxq 0 R long

         $ qselect -P dque

         25.console
&lt;/pre>
*查询指定主机上的作业
&lt;pre>
         $ qstat

         Job id Name User TimeUse S Pool

         25.console cpi zhangxq 0 Q dque

         29.console cpi zhangxq 0 R long

         $ qselect -P @console

         25.console

         29.console
&lt;/pre>

==挂起作业qhold==

===语法===
qhold [-h hold_list] job_identifier …

===作用===
挂起批处理作业。挂起有三种类型：普通用户级‘u’、管理员级（操作员级）‘o’、系统级‘s’，缺省值为不挂起‘n’。用户只能在用户级别挂起自己提交的作业，操作员可以在用户级和操作员级挂起任何作业，系统管理员可以在任何级别上挂起任何作业。

在执行该命令时，如果作业在运行结点池里排队，那么作业将直接被挂起；如果作业处于运行状态，为了中断作业的执行，必须采取其他办法。如果被挂起作业的主 机系统支持一致点检查或者重新启动，则挂起正在运行作业将引发以下操作：首先检查作业的一致性，然后释放该作业所占用的资源，最后该作业位于执行结点池 中，处于挂起状态；如果被挂起作业的主机系统不支持一致点检查或者重新启动，则仅设置指定的挂起作业类型，而实际上并不能挂起，除非调用qrerun命令 重新运行该作业时，该挂起请求才生效。

===举例===

*使用普通用户身份挂起作业
&lt;pre>
         $ qhold -h u 25.console $ qstat

         Job id Name User TimeUse S Pool

         25.console cpi zhangxq 0 H dque
&lt;/pre>
*以操作员身份挂起作业
&lt;pre>
         $ qhold -h o 25

         qhold: Unauthorized Request 25.console

         $ su root

         $ qhold -h o 25

         $ qstat

         Job id Name User TimeUse S Pool

         25.console cpi zhangxq 0 H dque
&lt;/pre>

==释放作业qrls==

===语法===
qrls [-h hold_list] job_identifier ...

===作用===
释放被挂起的批处理作业。由于作业的挂起有三种类型：USER、OPERATOR和SYSTEM。所以，要释放不同类型的作业挂起，用户就必须具有相应的权限。缺省为USER级

===举例===
释放在普通用户和操作员级被挂起的作业。
&lt;pre>
         $ qstat

         Job id Name User TimeUse S Pool

         25.console cpi zhangxq 0 H dque

         $ qrls -h uo 25

         $ qstat

         Job id Name User TimeUse S Pool

         25.console cpi zhangxq 0 Q dque
&lt;/pre>

 

==重新运行作业qrerun==

===语法===
qrerun job_identifier ...

===作用===
重新运行所指定的作业。

===举例===
如果作业允许别重新执行（缺省值是可以重新运行）。ROOT用户运行该命令，可以终止本次运行，把该作业放入其原来所在的结点池中，重新运行。
&lt;pre>
         $ qrerun 27

         qrerun: Unauthorized Request 27.console

         $ su – root

         $ qstat

         Job id Name User TimeUse S Pool

         25.console cpi zhangxq 0 Q dque

         27.console cpi zhangxq 0 R dque

         $ qrerun 27

         $ qstat

         Job id Name User TimeUse S Pool

         25.console cpi zhangxq 0 Q dque

         27.console cpi zhangxq 0 R dque
&lt;/pre>

==更改作业属性qalter==
===语法===
qalter [-a date_time] [-A account_string] [-e path] [-h hold_list] [-j join] [-k keep] [-l resource_list] [-m mail_options] [-M user_list] [-N name] [-o path] [-p priority] [-r c] [-u user_list] job_identifier...

===参数===
各参数的含义见qsub命令。

===作用===
更改批处理作业的属性。主要修改所指定作业ID的相关属性（选项表中所列出的属性）。

===举例===
*更改批处理作业的运行时间属性。

         $ qalter -a 0309251000 23.console

*更改给用户发送邮件的时间为作业中止和运行结束时

         $ qalter –m ae 23.console

==删除作业qdel==

===语法===
qdel [-W delay|force] job_identifier ...

===参数===
-W 当指定delay 时，表示在删除作业前需要等待的时间（秒）

当指定force时，强制删除该作业。

===作用===
删除批处理作业。按照命令行中所指定的作业ID的顺序来删除作业。

举例：
&lt;pre>
         $ qstat

         Job id Name User TimeUse S Pool

         22.console cpi zhangxq 0 Q long

         $ qdel 22
&lt;/pre>

==给作业发送消息qmsg==

===语法===
qmsg [-E] [-O] message_string job_identifier ...

===参数===
-E 将消息串写入错误输出文件

-O将消息串写入输出文件

===作用===

给批处理作业发送消息。该命令通过给作业的所有者（批处理服务器）发送消息，从而把消息写入作业的输出文件，也就是说，该命令并不是直接把消息写入作业的输出文件。

===举例===

给正在运行的作业发送消息，该消息被写入所指定作业的错误输出文件中。
&lt;pre>
         $ qstat

         Job id Name User TimeUse S Pool

         25.console cpi zhangxq 0 Q dque

         26.console cpi zhangxq 0 R dque

         $ qmsg “The job is running” 26

         $ more cpi.e26

         The job is running
&lt;/pre>

==在结点池之间移动作业qmove==

===语法===
qmove destination job_identifier ...

===参数===
destination可以为结点池名

===作用===
把批处理作业移到其他结点池中去运行。即把作业从所在的结点池中删除，并放在其他结点池中。

===举例===
&lt;pre>
         $ qstat

         Job id Name User TimeUse S Pool

         22.console cpi zhangxq 0 Q dque

         $ qmove long 22

         $ qstat

         Job id Name User TimeUse S Pool

         22.console cpi zhangxq 0 Q long
&lt;/pre>

==给作业发送信号qsig==

===语法===
qsig [-s signal] job_identifier ...

===参数===
参数signal可以为信号名称，如SIGKILL,KILL,SIGNULL或者无符号整数，如9、0。

===作用===
给正在运行的批处理作业发送信号。如果不指定-S选项，则发送“SIGTERM”信号。如果有下列原因之一，如用户无权给作业发送信号、作业未处于运行状态和该信号请求对作业所运行的系统无效，则拒绝执行该命令请求。

==查看和管理结点pbsnodes==

===语法===
pbsnodes [- {c|o|r}] [nodename …] pbsnodes - {a|l }]

===参数===
       -a 列出所有结点及其属性，属性包括“state”和“properties”

       -c 清除结点列表中的“offline”或“down”状态设置，使结点可以被分配给作业。

       -l 以行的方式列出被标记的结点的状态 -o 将指定结点的状态标记为“offline”。这将帮助管理员暂时停止某些结点的服务。

       -r 清除指定结点的“offline”状态

===作用===
该命令可以标记结点的状态为“offline”、“down”或“free”,也可以帮助用户查看结点信息。除了”-a” 和“-l”选项外，使用其他选项需要拥有操作员和管理员权限。

===举例===
*查看所有结点信息

         pbsnodes -a

*将结点标记为“offline”状态

         pbsnodes –o c0108

*清除结点的“offline”状态设置

         pbsnodes –c c0108 或 pbsnodes –r c0108

==查看所有计算结点的状态shownodes==

===语法===
shownodes [-h]

===作用===
按照结点池分类显示各结点池中结点的状态，结点状态以不同颜色显示。并在结点名后以数字代表可用CPU数和总共CPU数。例如c0101-2/2, 表示c0101结点可用2CPU总共2CPU，c0102-1/2表示C0102可用1CPU总共2CPU。

===举例===
         $shownodes –h
==checkjob查看作业详细信息==
===语法===
checkjob
Usage: checkjob [FLAGS] &lt;JOBID>
  --about
  --configfile=&lt;FILENAME>
  --format=&lt;FORMAT>
  --help
  --host=&lt;SERVERHOSTNAME>
  --keyfile=&lt;FILENAME>
  --loglevel=&lt;LOGLEVEL>
  --port=&lt;SERVERPORT>
  --version
  -A // AVP Mode
  -l &lt;POLICYLEVEL>
  -n &lt;NODE>
  -r &lt;RES_ID>
  -v // VERBOSE
===举例===
该命令可以查看作业的一些详细信息包括作业提交时间、开始时间等等，例如checkjob 2261
&lt;pre>
checking job 2261

State: Running
Creds:  user:hliu  group:Gene  class:big  qos:DEFAULT
WallTime: 3:05:59:28 of   INFINITY
SubmitTime: Tue Apr  7 15:51:56
  (Time Queued  Total: 00:00:02  Eligible: 00:00:02)

StartTime: Tue Apr  7 15:51:58
Total Tasks: 10

Req[0]  TaskCount: 10  Partition: DEFAULT
Network: [NONE]  Memory >= 0  Disk >= 0  Swap >= 0
Opsys: [NONE]  Arch: [NONE]  Features: [NONE]
Allocated Nodes:
[r910.cluster:10]


IWD: [NONE]  Executable:  [NONE]
Bypass: 0  StartCount: 1
PartitionMask: [ALL]
Flags:       RESTARTABLE

Reservation '2261' (-3:05:59:30 ->   INFINITY  Duration:   INFINITY)
PE:  10.00  StartPriority:  1
&lt;/pre>

==作业提交方式==
用户通过qsub命令来向系统提交任务，有两种方式提交：脚本方式和命令行方式。（一般情况下，不允许root用户使用qsub命令提交作业）。下面先讲一下用这两种方式提交作业的过程。
===脚本方式提交===

用户将需要执行的程序或命令写入脚本中，再加入一些必要或者可选的语句，就可以通脚本方式提交。脚本提交比较方便，用户可以用最简单的文字编辑器（例如 vi）编写一个脚本，然后使用 qsub 命令提交该脚本，pbs 会按照脚本内容执行相应的任务。脚本提交的不足之处就是需要用户执行任务前编写脚本。

脚本方式提交任务的一般格式为：qsub [script_name]，script_name 是任务脚本的名称。

pbs 任务脚本包括三部分：

*shell 说明语句：用来说明用户使用的是哪种 shell，例如 #!/bin/sh说明用户需要使用 Bourne shell，如果用户没有指定，则默认为 Bourne shell
* pbs 指示语句：pbs 指示语句是用户用来请求任务运行时所需的资源或设置任务的一些属性的。以#PBS开头，如#PBS –N taskname 是用来设置任务名称的。pbs 指示语句是可选的，用户可以不用关心它如何写，系统会自动设置。
* pbs 指示句的一个主要作用是请求任务执行时所需要的系统资源，如 cpu 数目，存储容量，运行时间，运行优先级等等。以脚本方式提交的任务的资源请求是通过 pbs 指示语句，一般格式为 #PBS –l [选项=] [选项对应的值]，如#PBS –l ncpus=5 表示请求 5 个cpu为之服务。系统资源如下所示：
&lt;pre>
arch 所需要的系统结构，只用在资源块中 -l arch=linux
cput 任务的所有进程拥有的最大 cpu 执行时间 -l cput=1:00:00
file 任务能够创建的文件的大小 -l file=45mb
host 指定执行主机的名称 -l nodes=X:host 分配 X个主机名称 中含有 host的执行节点
mem 任务的所有进程能够分配到的最大物理内存数 -l mem=100mb
ncpus 请求的 cpu数 -l ncup=5
nice 任务运行时的 nice 优先级值 -l nice=3
pcput 任务的任何一个进程拥有的最大 cpu 执行时间 -l pcput=1:00:00
pmem 任务的任何一个进程能够分配到的最大物理内存数 -l pmem=45mb
pvmem 任务的任何一个进程能够使用的虚拟内存的最大数 -l pvmem=100mb
vmem 任务的所有并发进程能够使用的最大虚存数 -l pvmem=100mb
walltime 任务可以处于运行态的最大 wall-clock 时间 -l walltime=1:00:00
custom resources 用户自定义资源
&lt;/pre>
最常用的几种资源是：walltime, ncpus, mem, host。其它可以不用太关心。

资源请求的两种方式：

*资源块方式：资源块是将任务所需的资源作为一个整体，这个整体中说明了所需要的各种资源的数目。其格式为：-l select=[N:]chunk[+[N:]chunk…]，如qsub –l select=2:ncpus=3:mem=4gb:arch=linux ，select=2表示需要2个这样的资源块，一个资源块包括3个cpu，4gb的内存，系统结构要求是linux，即总共需要6个cpu，8gb的内存。再如：-l select=2:ncpus=1:mem=10GB+3:ncpus=2:mem=8GB:arch=solaris注意中间的+号，是两个资源块的分隔符
*请求全任务(job-wide)资源：格式为 –l  keyword=value[,keyword=value ...]如：qsub -l ncpus=4,mem=123mb,arch=linux

任务（程序或命令）：可以是用户程序（如C程序），也可以是系统命令。

下面是一个完整的任务脚本例子，脚本名为 mytask：
&lt;pre>
         #!/bin/sh                 //指明所用的 shell
         #PBS –N mytask     //设置任务名称
         #PBS -l walltime=1:00:00       //请求任务执行时间
         #PBS -l select=ncpus=4:mem=400mb    //请求任务执行所需资源
         #PBS -j oe                       //设置相关属性(文件合并)
         date                           //系统命令（打印日期时间）
         .\my_application                 //所要执行的任务(当前目录名为 my_application的任务)
         date        //  系统命令
&lt;/pre>
第 1 行说明所用的 shell；第 2 至5 行是 pbs 指示语句，设置了任务的一些属性，并请求了资源；第 6 至8行是要执行的命令及任务。

编写完脚本后，使用 qsub 命令提交脚本，在 shell下输入：

         qsub mytask

后敲回车。

系统会输出一个任务标识符：sequence-number.servername，如 220.cnode01。sequence-number是任务编号，后面需要用这个号查看任务的执行状态，ervername是 pbs server的名称。
[[分类:服务器]]

===命令行方式提交===
命令行方式提交不用写脚本，用户可以直接从命令行输入。输入的内容基本上和在脚本中输入的相同。其基本格式如下：
&lt;pre>

qsub &lt;return>         //输入qsub命令后回车

[directives]     //pbs指示语句（以#PBS为前缀）

[tasks]       //任务或命令

ctrl-D        //结束输入，提交任务
&lt;/pre>
对于上面用脚本方式提交的任务，用命令行方式提交的格式如下：
&lt;pre>
         qsub
         #PBS –N mytask
         #PBS –l walltime=1:00:00
         #PBS –l select=ncpus=4:mem=400mb
         #PBS -j oe
         date /t
         ./my_application
         date /t
&lt;/pre>
注：以命令行方式提交任务时，这些命令选项都要以 pbs 指示语句的格式给出，即选项之前要加前缀#PBS。
任务提交后，用户如果要知道任务的当前运行状态，可以通过 qstat 命令查询。qstat 命令的常用选项有：
无选项：当 qstat 命令不带任何选项时，以默认方式显示任务信息，例如
&lt;pre>
         [soofree@node32]$ qstat
         Job id           Name             User        Time Use   S               Queue
         —————-   —————-      —————-    ————   ——
         569.node32    test             soofree          0             R               small
&lt;/pre>
其中，Job id 是任务的标识符，Name 是任务名称，User是任务所有者，Time Use 是CPU使用时间，S 是任务当前状态（本例中 R表示正在运行），Queue表示任务所在队列。任务的状态如下：
&lt;pre>
* B  只用于任务向量，表示任务向量已经开始执行
* E  任务在运行后退出
* H  任务被服务器或用户或者管理员阻塞
* Q  任务正在排队中，等待被调度运行
* R  任务正在运行
* S  任务被服务器挂起，由于一个更高优先级的任务需要当前任务的资源
* T  任务被转移到其它执行节点了
* U  由于服务器繁忙，任务被挂起
* W  任务在等待它所请求的执行时间的到来(qsub -a)
* X  只用于子任务，表示子任务完成
&lt;/pre>
再举一例，使用-a 选项指定任务开始执行时间：
&lt;pre>
         [soofree@nod32]$ qsub -a 2102 test
         571.node32
         [soofree@node32]$ qstat

         Job id           Name     User    Time Use S  Queue
         —————- —————- —————- ———– — ——–
         570.cnode01      test       soofree     0    W    default
&lt;/pre>
==作业退出代码==
{| class="wikitable" style="width:50%"
|-
!Name !!Value !!Description
|-
|JOB_EXEC_OK ||0|| Job execution successful
|-
|JOB_EXEC_FAIL1|| -1|| Job execution failed, before files, no retry
|-
|JOB_EXEC_FAIL2 ||-2 ||Job execution failed, after files, no retry
|-
|JOB_EXEC_RETRY ||-3 ||Job execution failed, do retry
|-
|JOB_EXEC_INITABT ||-4 ||Job aborted on MOM initialization
|-
|JOB_EXEC_INITRST ||-5 ||Job aborted on MOM init, chkpt, no migrate
|-
|JOB_EXEC_INITRMG ||-6 ||Job aborted on MOM init, chkpt, ok migrate
|-
|JOB_EXEC_BADRESRT ||-7|| Job restart failed
|-
|JOB_EXEC_CMDFAIL ||-8|| Exec() of user command failed
|-
|JOB_EXEC_STDOUTFAIL|| -9 ||Could not create/open stdout stderr files
|-
|JOB_EXEC_OVERLIMIT_MEM ||-10|| Job exceeded a memory limit
|-
|JOB_EXEC_OVERLIMIT_WT ||-11|| Job exceeded a walltime limit
|-
|JOB_EXEC_OVERLIMIT_CPUT ||-12 ||Job exceeded a CPU time limit
|}
[[分类:服务器]]
[[分类:PBS]]
</textarea><div class="templatesUsed"></div><p id="mw-returnto">返回<a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/PBS使用" title="PBS使用">PBS使用</a>。</p>
</div>									<div class="printfooter">
						取自“<a dir="ltr" href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/PBS使用">http://hpc.ncpgr.cn:8093/mediawiki/index.php/PBS使用</a>”					</div>
													<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>导航菜单</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">个人工具</h3>
						<ul>
							<li id="pt-anonuserpage"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/用户:122.205.65.137" class="new" title="你用于编辑的IP地址的用户页面[.]" accesskey=".">122.205.65.137</a></li><li id="pt-anontalk"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/用户讨论:122.205.65.137" class="new" title="有关本IP地址的编辑的讨论[n]" accesskey="n">该IP地址的讨论</a></li><li id="pt-createaccount"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php?title=%E7%89%B9%E6%AE%8A:%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95&amp;returnto=PBS%E4%BD%BF%E7%94%A8&amp;returntoquery=action%3Dedit&amp;type=signup">创建账户</a></li><li id="pt-login"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php?title=%E7%89%B9%E6%AE%8A:%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95&amp;returnto=PBS%E4%BD%BF%E7%94%A8&amp;returntoquery=action%3Dedit" title="我们鼓励您登录，不过这不是强制的[o]" accesskey="o">登录</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">命名空间</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/PBS使用"  title="查看内容页面[c]" accesskey="c">页面</a></span></li>
															<li  id="ca-talk" class="new"><span><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php?title=%E8%AE%A8%E8%AE%BA:PBS%E4%BD%BF%E7%94%A8&amp;action=edit&amp;redlink=1"  title="关于内容页面的讨论[t]" accesskey="t">讨论</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label"><span>变种</span><a href="#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">视图</h3>
						<ul>
															<li id="ca-view"><span><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/PBS使用" >阅读</a></span></li>
															<li id="ca-viewsource" class="selected"><span><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php?title=PBS%E4%BD%BF%E7%94%A8&amp;action=edit"  title="本页面受到保护。&#10;您可以查看其源代码[e]" accesskey="e">查看源代码</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php?title=PBS%E4%BD%BF%E7%94%A8&amp;action=history"  title="本页面过去的版本[h]" accesskey="h">查看历史</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>更多</span><a href="#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">搜索</label>
						</h3>

						<form action="http://hpc.ncpgr.cn:8093/mediawiki/index.php" id="searchform">
														<div id="simpleSearch">
															<input type="search" name="search" placeholder="搜索" title="搜索作物遗传改良国家重点实验室集群系统[f]" accesskey="f" id="searchInput" /><input type="hidden" value="特殊:搜索" name="title" /><input type="submit" name="fulltext" value="搜索" title="搜索含这些文字的页面" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="前往" title="如果相同的标题存在的话便直接前往该页面" id="searchButton" class="searchButton" />								</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a style="background-image: url(http://hpc.ncpgr.cn:8093/mediawiki/resources/assets/wiki.png);" href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/首页"  title="访问首页"></a></div>
						<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
			<h3 id='p-navigation-label'>导航</h3>

			<div class="body">
									<ul>
													<li id="n-mainpage-description"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/首页" title="访问首页[z]" accesskey="z">首页</a></li>
													<li id="n-recentchanges"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/特殊:最近更改" title="本wiki最近更改的列表[r]" accesskey="r">最近更改</a></li>
													<li id="n-randompage"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/特殊:随机页面" title="载入一个随机页面[x]" accesskey="x">随机页面</a></li>
													<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="查找帮助的地方">帮助</a></li>
											</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>工具</h3>

			<div class="body">
									<ul>
													<li id="t-whatlinkshere"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/特殊:链入页面/PBS使用" title="所有链接至本页面的wiki页面的列表[j]" accesskey="j">链入页面</a></li>
													<li id="t-recentchangeslinked"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/特殊:相关更改/PBS使用" title="链自本页的页面的最近更改[k]" accesskey="k">相关更改</a></li>
													<li id="t-specialpages"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/特殊:特殊页面" title="所有特殊页面的列表[q]" accesskey="q">特殊页面</a></li>
													<li id="t-info"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php?title=PBS%E4%BD%BF%E7%94%A8&amp;action=info">页面信息</a></li>
											</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/Cluster:隐私权政策" title="Cluster:隐私权政策">隐私政策</a></li>
											<li id="footer-places-about"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/Cluster:关于" title="Cluster:关于">关于作物遗传改良国家重点实验室集群系统</a></li>
											<li id="footer-places-disclaimer"><a href="http://hpc.ncpgr.cn:8093/mediawiki/index.php/Cluster:免责声明" title="Cluster:免责声明">免责声明</a></li>
									</ul>
									<div style="clear:both"></div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.edit.collapsibleFooter","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"http://hpc.ncpgr.cn:8093/mediawiki/load.php?debug=false\u0026amp;lang=zh-cn\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=vector\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":305});
}</script>
	</body>

<!-- Mirrored from hpc.ncpgr.cn:8093/mediawiki/index.php?title=PBS%E4%BD%BF%E7%94%A8&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 13 May 2019 09:34:57 GMT -->
</html>
	